#!/usr/bin/env node

var commander = require('commander'),

    TCase     = require(__dirname + '/..'),
    version   = require(__dirname + '/../package.json').version,
    filelist  = require(__dirname + '/../lib/filelist');

// コマンドライン引数読み込み
commander
	.version(version)
	.parse(process.argv);

var tcase;
var command = 'select';
if ((commander.args[0] || '').match(/^(ls|select|add-file)$/)) {
	command = commander.args.shift();
}

var selector = commander.args.join(' ') || 't';

if (command == 'select') {
	// ファイルを結合して、sourceにする
	filelist.concat(function (err, source) {
		if (err) {
			console.error(err);
			return;
		}

		// TCaseを生成、selectの結果をformatして出力
		tcase = new TCase(source);
		console.log(tcase.select(selector).format());
	});
} else if (command == 'ls') {
	console.log(filelist.ls());
} else if (command == 'add-file') {
	filelist.addFile(commander.args.shift());
	console.log(filelist.ls());
}

