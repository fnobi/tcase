#!/usr/bin/env node

process.env.NODE_CONFIG_DIR = __dirname + '/../config/';

var fs        = require('fs'),
    path      = require('path'),

    async     = require('async'),
    commander = require('commander'),
    config    = require('config'),

    TCase     = require(__dirname + '/..'),
    pkg       = require(__dirname + '/../package.json'),
    version   = pkg.version;


// コマンドライン引数読み込み
commander
	.version(version)
	.option('-o, --output [path]', 'output path')
	.option('-a, --app', 'as .app file (with macgap)')
	.parse(process.argv);


var tcase = new TCase();
var selector = commander.args.join(' ') || 't,i';


TCase.sourceFiles(function (err, sourceFiles) {
	if (err) {
		throw new Error(err);
	}

	async.forEach(sourceFiles, function (sourceFile, callback) {
		fs.readFile(sourceFile, 'utf8', function (err, content) {
			tcase.addSource(content);
			callback(err, true);
		});
	}, function (err, res) {
		console.log(tcase.select(selector).format());
	});
});